C51 COMPILER V9.60.0.0   MAIN                                                              08/13/2020 21:26:07 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) OBJECT(.\Objects\main.obj)

line level    source

   1          //程序参考：http://www.dzdiy.com/html/201305/19/LCD1602.htm
   2          #include <reg52.h>    //包含单片机寄存器的头文件
   3          #include <intrins.h>
   4          #define LCD_data P2
   5          sbit RS=P3^2;
   6          sbit Rw=P3^3;
   7          sbit E =P3^4;
   8          
   9          unsigned char code digit[ ]={"0123456789"}; //定义字符数组显示数字
  10          //*****************延时************************
  11          void delay_nus(unsigned int n) //N us延时函数
  12          {
  13   1              unsigned int i=0;
  14   1                      for (i=0;i<n;i++)
  15   1                              _nop_();
  16   1      }
  17          void delay_nms(unsigned int n) //N ms延时函数
  18          {
  19   1              unsigned int i,j;
  20   1                      for (i=0;i<n;i++)
  21   1                              for (j=0;j<1140;j++);
  22   1      }
  23          //*************液晶屏使能****************************
  24          void LCD_en_write(void) 
  25          {
  26   1              E=1;
  27   1              delay_nus(1);
  28   1              E=0;
  29   1      }
  30          //*************写命令****************************
  31          void LCD_write_command(unsigned char command)
  32          {
  33   1              delay_nus(16);
  34   1              RS=0;
  35   1              Rw=0;
  36   1              LCD_data&=0X0f; //清高四位
  37   1              LCD_data|=command&0xf0; //写高四位
  38   1              LCD_en_write();
  39   1              command=command<<4; //低四位移到高四位
  40   1              LCD_data&=0x0f; //清高四位
  41   1              LCD_data|=command&0xf0; //写低四位
  42   1              LCD_en_write();
  43   1      }
  44          //*************写数据****************************
  45          void LCD_write_data(unsigned char value) 
  46          {
  47   1              delay_nus(16);
  48   1              RS=1;
  49   1              Rw=0;
  50   1              LCD_data&=0X0f; //清高四位
  51   1              LCD_data|=value&0xf0; //写高四位
  52   1              LCD_en_write();
  53   1              value=value<<4; //低四位移到高四位
  54   1              LCD_data&=0X0f; //清高四位
C51 COMPILER V9.60.0.0   MAIN                                                              08/13/2020 21:26:07 PAGE 2   

  55   1              LCD_data|=value&0xf0; //写低四位
  56   1              LCD_en_write();
  57   1      }
  58          
  59          //**********************设置显示位置*********************************
  60          void set_position(unsigned char x,unsigned char y)
  61          {
  62   1              unsigned char position;
  63   1              if (y == 0)
  64   1              position = 0x80 + x;
  65   1              else 
  66   1                      position = 0xc0 + x;
  67   1          LCD_write_command(position);
  68   1      }
  69          //**********************显示字符串*****************************
  70          
  71          void display_string(unsigned char x,unsigned char y,unsigned char *s)
  72          { 
  73   1          set_position(x,y);
  74   1              while (*s) 
  75   1              {     
  76   2                      LCD_write_data(*s);     
  77   2                      s++;     
  78   2              }
  79   1      }
  80          //********************显示数字*******************************xs
  81          void display_num(unsigned char x,unsigned char y,unsigned int num)
  82          { 
  83   1         unsigned char i,j,k,m,n;
  84   1         set_position(x,y);
  85   1          i=num/10000;
  86   1          j=num/1000%10; 
  87   1              k=num/100%10;
  88   1              m=num/10%10;
  89   1          n=num%10;
  90   1              LCD_write_data(digit[i]);    //将万位数字的字符常量写入LCD
  91   1              LCD_write_data(digit[j]);    //将千位数字的字符常量写入LCD
  92   1              LCD_write_data(digit[k]);
  93   1              LCD_write_data(digit[m]);
  94   1          LCD_write_data('.');
  95   1              LCD_write_data(digit[n]);
  96   1      }
  97          //*************液晶初始化****************************
  98          void LCD_init(void) 
  99          { 
 100   1              LCD_write_command(0x28);
 101   1              delay_nus(40); 
 102   1              LCD_write_command(0x28);
 103   1              delay_nus(40); 
 104   1              LCD_en_write();
 105   1              delay_nus(40);
 106   1              LCD_write_command(0x28); //4位显示！！！！！！！！！！！！！！！！！！
 107   1              LCD_write_command(0x0c); //显示开
 108   1              LCD_write_command(0x01); //清屏
 109   1              delay_nms(2);
 110   1      }
 111          //*************主函数************************
 112          void main(void)
 113          {
 114   1              int i;
 115   1              LCD_init();
 116   1              display_string(0,0,"Hello Today!"); //显示一段文字
C51 COMPILER V9.60.0.0   MAIN                                                              08/13/2020 21:26:07 PAGE 3   

 117   1              while(1)
 118   1              {
 119   2                      display_num(0,1,i); 
 120   2                      delay_nms(50);
 121   2                      i++;
 122   2              }
 123   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    407    ----
   CONSTANT SIZE    =     24    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
